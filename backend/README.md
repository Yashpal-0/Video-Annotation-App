# Backend for Video Annotation Tool

This directory contains the Node.js, Express, and MongoDB backend for the Video Annotation Tool. It provides a REST API for managing video annotations.

## Setup

1.  **Install Dependencies:**
    Navigate to the `backend` directory and run:
    ```bash
    npm install
    ```

2.  **MongoDB Setup:**
    Ensure you have a MongoDB instance running. This can be a local instance or a cloud-hosted one (e.g., MongoDB Atlas).

3.  **Environment Variables:**
    Create a `.env` file in this `backend` directory with the following content:
    ```env
    PORT=5000
    MONGO_URI=mongodb://localhost:27017/video_annotation_db # Replace with your MongoDB connection string
    ```
    - Replace `mongodb://localhost:27017/video_annotation_db` with your actual MongoDB connection URI. 
    - `video_annotation_db` is an example database name; it will be created if it doesn't exist.
    - The `PORT` defaults to `5000` if not set in `.env` or via the system environment.

4.  **Run the Server:**
    For development with auto-restarting (using `nodemon`):
    ```bash
    npm run dev
    ```
    For production:
    ```bash
    npm start
    ```
    The server will typically start on `http://localhost:5000` (or the port specified in your `.env` file).
    You should see "MongoDB connected" and "Server listening on port..." messages in the console.

## API Endpoints

### Video Configuration

*   **GET `/api/video/config`**
    *   Description: Fetches video configuration, including the source URL.
    *   Response: `200 OK`
        ```json
        {
          "src": "http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
        }
        ```

### Annotations

Base URL for annotations: `/api/annotations`

*   **GET `/`**
    *   Description: Fetches all annotations, sorted by timestamp.
    *   Response: `200 OK` with an array of annotation objects.
    *   Example: `GET /api/annotations`

*   **POST `/`**
    *   Description: Creates a new annotation.
    *   Request Body (JSON) - Note: `id` should not be sent; `_id` is generated by MongoDB.
        ```json
        {
          "type": "circle", // "circle", "rectangle", "line", "text"
          "relativeX": 0.1,       
          "relativeY": 0.2,       
          "relativeWidth": 0.05,  // For rectangle
          "relativeHeight": 0.05, // For rectangle
          "relativeRadius": 0.03, // For circle
          "relativePoints": [{"x": 0.1, "y": 0.1}, {"x": 0.2, "y": 0.2}], // For line
          "text": "Important point", // For text annotations
          "timestamp": 15.7,  
          "duration": 3 
        }
        ```
    *   Response: `201 Created` with the newly created annotation object (including its `_id` as `id`).

*   **PUT `/:id`**
    *   Description: Updates an existing annotation by its MongoDB `_id`.
    *   URL Parameters:
        *   `id` (String): The MongoDB `_id` of the annotation to update.
    *   Request Body (JSON): Object containing fields to update. Any fields from the schema can be updated.
        ```json
        {
          "text": "Updated important point",
          "duration": 5
        }
        ```
    *   Response: `200 OK` with the updated annotation object. `404 Not Found` if ID doesn't exist.

*   **DELETE `/:id`**
    *   Description: Deletes an annotation by its MongoDB `_id`.
    *   URL Parameters:
        *   `id` (String): The MongoDB `_id` of the annotation to delete.
    *   Response: `204 No Content` on success. `404 Not Found` if ID doesn't exist.

## Models

### Annotation (`Annotation.js`)

Defines the schema for annotations stored in MongoDB.

Key Fields:
*   `type` (String, Enum: ['circle', 'rectangle', 'line', 'text'], Required)
*   `relativeX`, `relativeY` (Number) - Relative X, Y coordinates (0.0 to 1.0).
*   `relativeWidth`, `relativeHeight` (Number) - Relative dimensions for rectangles.
*   `relativeRadius` (Number) - Relative radius for circles.
*   `relativePoints` (Array of Objects) - Array of relative `{x, y}` points for lines.
*   `text` (String) - Text content for text annotations.
*   `timestamp` (Number, Required) - Timestamp in seconds when the annotation should appear.
*   `duration` (Number, Required) - Duration in seconds the annotation is visible.
*   `createdAt`, `updatedAt` (Date) - Timestamps managed by Mongoose.

MongoDB automatically assigns an `_id` to each annotation document. 